# 2.30 消息安全设计

## 目录

- [2.30 消息安全设计](#230-消息安全设计)
  - [目录](#目录)
  - [2.30.1 安全场景](#2301-安全场景)
    - [常见场景](#常见场景)
  - [2.30.2 Kafka安全](#2302-kafka安全)
    - [安全配置](#安全配置)
    - [ACL配置](#acl配置)
  - [2.30.3 NATS安全](#2303-nats安全)
    - [安全配置](#安全配置-1)
  - [2.30.4 RabbitMQ安全](#2304-rabbitmq安全)
    - [安全配置](#安全配置-2)
  - [2.30.5 安全最佳实践](#2305-安全最佳实践)
    - [设计建议](#设计建议)

---

## 2.30.1 安全场景

### 常见场景

1. **认证授权**
   - 用户认证
   - 权限控制
   - 访问管理

2. **数据安全**
   - 传输加密
   - 存储加密
   - 数据脱敏

3. **网络安全**
   - 网络隔离
   - 防火墙规则
   - VPN连接

---

## 2.30.2 Kafka安全

### 安全配置

```java
// SASL/PLAIN认证
Properties props = new Properties();
props.put("security.protocol", "SASL_SSL");
props.put("sasl.mechanism", "PLAIN");
props.put("sasl.jaas.config",
    "org.apache.kafka.common.security.plain.PlainLoginModule required " +
    "username=\"admin\" password=\"admin-secret\";");

// SSL/TLS加密
props.put("ssl.truststore.location", "/path/to/truststore.jks");
props.put("ssl.truststore.password", "password");
props.put("ssl.keystore.location", "/path/to/keystore.jks");
props.put("ssl.keystore.password", "password");
```

### ACL配置

```bash
# 创建ACL规则
kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181 \
    --add --allow-principal User:producer \
    --operation Write --topic orders

kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181 \
    --add --allow-principal User:consumer \
    --operation Read --topic orders
```

---

## 2.30.3 NATS安全

### 安全配置

```go
// TLS配置
opts := nats.Options{
    Secure: true,
    TLSConfig: &tls.Config{
        InsecureSkipVerify: false,
        Certificates: []tls.Certificate{cert},
    },
}

// 认证配置
opts.User = "admin"
opts.Password = "admin-secret"

// 连接
nc, _ := nats.Connect("nats://localhost:4222", &opts)
```

---

## 2.30.4 RabbitMQ安全

### 安全配置

```python
# TLS/SSL连接
import ssl

context = ssl.create_default_context(cafile="/path/to/ca.pem")
ssl_options = {
    'ca_certs': '/path/to/ca.pem',
    'certfile': '/path/to/client.pem',
    'keyfile': '/path/to/client-key.pem',
}

connection = pika.BlockingConnection(
    pika.ConnectionParameters(
        host='localhost',
        port=5671,
        ssl_options=pika.SSLOptions(context),
        credentials=pika.PlainCredentials('admin', 'admin-secret')
    )
)
```

---

## 2.30.5 安全最佳实践

### 设计建议

1. **安全设计**
   - 最小权限原则
   - 多层防护
   - 定期审计

2. **加密策略**
   - 传输加密（TLS/SSL）
   - 存储加密
   - 密钥管理

3. **访问控制**
   - 身份认证
   - 权限控制
   - 审计日志

---

**最后更新**: 2025-12-31
