# 2.10 高可用架构设计

## 目录

- [2.10 高可用架构设计](#210-高可用架构设计)
  - [目录](#目录)
  - [2.10.1 高可用设计原则](#2101-高可用设计原则)
    - [设计原则](#设计原则)
  - [2.10.2 Kafka高可用架构](#2102-kafka高可用架构)
    - [架构设计](#架构设计)
    - [高可用配置](#高可用配置)
  - [2.10.3 NATS高可用架构](#2103-nats高可用架构)
    - [集群架构](#集群架构)
    - [高可用配置](#高可用配置-1)
  - [2.10.4 RabbitMQ高可用架构](#2104-rabbitmq高可用架构)
    - [镜像队列架构](#镜像队列架构)
    - [高可用配置](#高可用配置-2)
  - [2.10.5 多活架构设计](#2105-多活架构设计)
    - [跨地域多活](#跨地域多活)
    - [数据同步](#数据同步)

---

## 2.10.1 高可用设计原则

### 设计原则

1. **冗余设计**
   - 多节点部署
   - 多副本存储
   - 多路径访问

2. **故障隔离**
   - 故障域隔离
   - 资源隔离
   - 网络隔离

3. **自动恢复**
   - 自动故障检测
   - 自动故障转移
   - 自动数据恢复

---

## 2.10.2 Kafka高可用架构

### 架构设计

```
┌─────────┐  ┌─────────┐  ┌─────────┐
│Broker 1 │  │Broker 2 │  │Broker 3 │
│(Leader) │  │(Follower)│ │(Follower)│
└─────────┘  └─────────┘  └─────────┘
     │             │             │
     └─────────────┴─────────────┘
              │
        ┌─────┴─────┐
        │  Client   │
        └───────────┘
```

### 高可用配置

```properties
# 至少3个Broker
replication.factor=3
min.insync.replicas=2

# 自动Leader选举
unclean.leader.election.enable=false
```

---

## 2.10.3 NATS高可用架构

### 集群架构

```
┌─────────┐  ┌─────────┐  ┌─────────┐
│ NATS 1  │◄─┤ NATS 2  │◄─┤ NATS 3  │
└─────────┘  └─────────┘  └─────────┘
     │             │             │
     └─────────────┴─────────────┘
```

### 高可用配置

```conf
# 集群配置
cluster {
  routes = [
    "nats://nats-2:6222",
    "nats://nats-3:6222"
  ]
}
```

---

## 2.10.4 RabbitMQ高可用架构

### 镜像队列架构

```
┌─────────┐  ┌─────────┐  ┌─────────┐
│ Node 1  │  │ Node 2  │  │ Node 3  │
│(Master) │  │(Mirror) │  │(Mirror) │
└─────────┘  └─────────┘  └─────────┘
```

### 高可用配置

```bash
# 设置镜像队列策略
rabbitmqctl set_policy ha-all "^" '{"ha-mode":"all"}'
```

---

## 2.10.5 多活架构设计

### 跨地域多活

- **主-主模式**：双活数据中心
- **主-备模式**：主数据中心 + 备用数据中心
- **多活模式**：多个数据中心同时服务

### 数据同步

- **同步复制**：强一致性，高延迟
- **异步复制**：最终一致性，低延迟
- **混合模式**：关键数据同步，其他异步

---

**最后更新**: 2025-12-31
