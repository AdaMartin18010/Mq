# 3.13 性能调优实战案例

## 目录

- [3.13 性能调优实战案例](#313-性能调优实战案例)
  - [目录](#目录)
  - [3.13.1 Kafka性能调优案例](#3131-kafka性能调优案例)
    - [案例1：吞吐量优化](#案例1吞吐量优化)
  - [3.13.2 MQTT性能调优案例](#3132-mqtt性能调优案例)
    - [案例1：连接数优化](#案例1连接数优化)
  - [3.13.3 NATS性能调优案例](#3133-nats性能调优案例)
    - [案例1：延迟优化](#案例1延迟优化)
  - [3.13.4 Pulsar性能调优案例](#3134-pulsar性能调优案例)
    - [案例1：写入性能优化](#案例1写入性能优化)
  - [3.13.5 RabbitMQ性能调优案例](#3135-rabbitmq性能调优案例)
    - [案例1：队列性能优化](#案例1队列性能优化)
  - [3.13.6 性能调优总结](#3136-性能调优总结)
    - [通用优化策略](#通用优化策略)

---

## 3.13.1 Kafka性能调优案例

### 案例1：吞吐量优化

**问题**：Producer吞吐量仅10万TPS，目标100万+TPS

**调优前**：

```properties
batch.size=16384
linger.ms=0
compression.type=none
acks=1
```

**调优后**：

```properties
batch.size=65536  # 64KB批量
linger.ms=10      # 等待10ms批量发送
compression.type=lz4  # LZ4压缩
acks=1
buffer.memory=134217728  # 128MB缓冲区
```

**效果**：吞吐量提升至120万TPS（提升12倍）

---

## 3.13.2 MQTT性能调优案例

### 案例1：连接数优化

**问题**：单Broker仅支持5万连接，目标10万+

**调优**：

- 增加文件描述符限制：`ulimit -n 100000`
- 优化TCP参数：`net.core.somaxconn=32768`
- 使用连接池：复用TCP连接

**效果**：支持12万并发连接

---

## 3.13.3 NATS性能调优案例

### 案例1：延迟优化

**问题**：P99延迟500μs，目标<100μs

**调优**：

- 使用专用网络（同机房）
- 禁用Nagle算法：`TCP_NODELAY=1`
- 优化GC参数（Go版本）

**效果**：P99延迟降至80μs

---

## 3.13.4 Pulsar性能调优案例

### 案例1：写入性能优化

**问题**：写入吞吐量50万TPS，目标100万+

**调优**：

- 增加BookKeeper线程数
- 优化Ledger写入策略
- 使用SSD存储

**效果**：写入吞吐量提升至120万TPS

---

## 3.13.5 RabbitMQ性能调优案例

### 案例1：队列性能优化

**问题**：单队列吞吐量1万TPS，目标5万+

**调优**：

- 使用非持久化队列（内存队列）
- 批量确认：`prefetch_count=100`
- 优化Erlang进程数

**效果**：吞吐量提升至6万TPS

---

## 3.13.6 性能调优总结

### 通用优化策略

1. **批量操作**：减少网络往返
2. **压缩**：减少网络传输
3. **连接复用**：减少连接开销
4. **硬件优化**：SSD、高速网络
5. **参数调优**：根据场景调整配置

---

**最后更新**: 2025-12-31
