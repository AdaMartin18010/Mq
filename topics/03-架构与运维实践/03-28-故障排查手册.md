# 3.28 故障排查手册

## 目录

- [3.28 故障排查手册](#328-故障排查手册)
  - [目录](#目录)
  - [3.28.1 常见故障类型](#3281-常见故障类型)
    - [故障分类](#故障分类)
  - [3.28.2 Kafka故障排查](#3282-kafka故障排查)
    - [连接问题](#连接问题)
    - [性能问题](#性能问题)
  - [3.28.3 NATS故障排查](#3283-nats故障排查)
    - [连接问题](#连接问题-1)
    - [性能问题](#性能问题-1)
  - [3.28.4 RabbitMQ故障排查](#3284-rabbitmq故障排查)
    - [连接问题](#连接问题-2)
    - [性能问题](#性能问题-2)
  - [3.28.5 故障排查流程](#3285-故障排查流程)
    - [排查步骤](#排查步骤)

---

## 3.28.1 常见故障类型

### 故障分类

1. **连接故障**
   - 无法连接服务器
   - 连接超时
   - 连接断开

2. **性能故障**
   - 吞吐量下降
   - 延迟增加
   - 资源耗尽

3. **数据故障**
   - 消息丢失
   - 消息重复
   - 数据损坏

---

## 3.28.2 Kafka故障排查

### 连接问题

```bash
# 检查Broker状态
kafka-broker-api-versions.sh --bootstrap-server localhost:9092

# 检查网络连接
telnet localhost 9092

# 查看日志
tail -f kafka_*/logs/server.log
```

### 性能问题

```bash
# 检查Topic分区
kafka-topics.sh --describe --topic test --bootstrap-server localhost:9092

# 检查消费者延迟
kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group my-group --describe
```

---

## 3.28.3 NATS故障排查

### 连接问题

```bash
# 检查Server状态
curl http://localhost:8222/varz

# 检查端口
netstat -tuln | grep 4222

# 查看日志
journalctl -u nats-server
```

### 性能问题

```bash
# 检查连接数
curl http://localhost:8222/varz | grep connections

# 检查内存使用
curl http://localhost:8222/varz | grep mem
```

---

## 3.28.4 RabbitMQ故障排查

### 连接问题

```bash
# 检查节点状态
rabbitmqctl status

# 检查端口
netstat -tuln | grep 5672

# 查看日志
tail -f /var/log/rabbitmq/rabbit@*.log
```

### 性能问题

```bash
# 检查队列状态
rabbitmqctl list_queues name messages messages_ready

# 检查连接数
rabbitmqctl list_connections
```

---

## 3.28.5 故障排查流程

### 排查步骤

1. **收集信息**
   - 故障现象
   - 错误日志
   - 系统指标

2. **定位问题**
   - 检查日志
   - 分析指标
   - 复现问题

3. **解决问题**
   - 执行修复
   - 验证恢复
   - 记录总结

---

**最后更新**: 2025-12-31
