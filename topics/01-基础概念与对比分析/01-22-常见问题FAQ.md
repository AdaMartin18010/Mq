# 1.22 常见问题FAQ

## 目录

- [1.22 常见问题FAQ](#122-常见问题faq)
  - [目录](#目录)
  - [1.22.1 选型问题](#1221-选型问题)
    - [Q1: 如何选择消息队列系统？](#q1-如何选择消息队列系统)
  - [1.22.2 性能问题](#1222-性能问题)
    - [Q2: Kafka吞吐量如何优化？](#q2-kafka吞吐量如何优化)
  - [1.22.3 部署问题](#1223-部署问题)
    - [Q3: 如何部署高可用集群？](#q3-如何部署高可用集群)
  - [1.22.4 运维问题](#1224-运维问题)
    - [Q4: 如何监控消息队列？](#q4-如何监控消息队列)
  - [1.22.5 故障问题](#1225-故障问题)
    - [Q5: 消息丢失如何处理？](#q5-消息丢失如何处理)

---

## 1.22.1 选型问题

### Q1: 如何选择消息队列系统？

**A**: 根据以下因素选择：

1. **场景需求**
   - 日志聚合 → Kafka
   - IoT设备 → MQTT
   - 微服务通信 → NATS
   - 任务队列 → RabbitMQ

2. **性能要求**
   - 高吞吐量 → Kafka/NATS
   - 低延迟 → NATS Core
   - 持久化 → Kafka/RabbitMQ

3. **运维复杂度**
   - 简单 → NATS/MQTT
   - 中等 → RabbitMQ
   - 复杂 → Kafka

---

## 1.22.2 性能问题

### Q2: Kafka吞吐量如何优化？

**A**: 优化策略：

1. **Producer优化**
   - 批量发送（batch.size）
   - 压缩（compression.type）
   - 异步发送

2. **Consumer优化**
   - 批量拉取
   - 多线程消费
   - 合理分区数

3. **Broker优化**
   - 独立磁盘
   - 合理副本数
   - JVM调优

---

## 1.22.3 部署问题

### Q3: 如何部署高可用集群？

**A**: 部署要点：

1. **节点数量**
   - 至少3个节点
   - 奇数节点（避免脑裂）

2. **副本配置**
   - 副本数≥3
   - 至少2个同步副本

3. **网络配置**
   - 同机房部署
   - 低延迟网络

---

## 1.22.4 运维问题

### Q4: 如何监控消息队列？

**A**: 监控方案：

1. **指标监控**
   - Prometheus收集指标
   - Grafana可视化

2. **关键指标**
   - 吞吐量
   - 延迟
   - 错误率
   - 资源使用

3. **告警设置**
   - 合理阈值
   - 分级告警

---

## 1.22.5 故障问题

### Q5: 消息丢失如何处理？

**A**: 预防措施：

1. **Producer**
   - acks=all
   - 重试机制
   - 事务支持

2. **Broker**
   - 多副本
   - 持久化
   - 定期备份

3. **Consumer**
   - 手动确认
   - 幂等处理
   - 死信队列

---

**最后更新**: 2025-12-31
