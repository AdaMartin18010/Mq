# 消息降级配置模板

# 降级策略配置
degrade.enabled=true
degrade.strategy=circuit_breaker  # circuit_breaker/rate_limit/timeout
degrade.trigger.condition=system_overload  # system_overload/service_failure/business_degrade

# 熔断器配置
circuit.breaker.enabled=true
circuit.breaker.failure.threshold=5  # 失败5次触发熔断
circuit.breaker.time.window.seconds=60  # 60秒时间窗口
circuit.breaker.half.open.timeout.seconds=10  # 半开状态10秒
circuit.breaker.success.threshold=3  # 3次成功恢复
circuit.breaker.state.monitor.enabled=true

# 限流降级配置
rate.limit.degrade.enabled=true
rate.limit.degrade.threshold=0.8  # 80%限流触发降级
rate.limit.degrade.priority.enabled=true
rate.limit.degrade.priority.levels=3  # 高/中/低优先级

# 超时降级配置
timeout.degrade.enabled=true
timeout.degrade.threshold.ms=5000  # 5秒超时触发降级
timeout.degrade.fast.fail.enabled=true

# 降级处理配置
degrade.handling.strategy=local_storage  # local_storage/async_compensate/notification
degrade.handling.local.storage.enabled=true
degrade.handling.local.storage.path=/var/mq/degrade
degrade.handling.local.storage.max.size=10GB
degrade.handling.async.compensate.enabled=true
degrade.handling.async.compensate.interval.seconds=60
degrade.handling.notification.enabled=true
degrade.handling.notification.channels=email,slack

# 降级恢复配置
degrade.recovery.enabled=true
degrade.recovery.strategy=automatic  # automatic/manual
degrade.recovery.automatic.enabled=true
degrade.recovery.automatic.interval.seconds=30
degrade.recovery.manual.enabled=true
degrade.recovery.manual.api.enabled=true

# 降级监控配置
degrade.monitor.enabled=true
degrade.monitor.metrics=degrade_count,degrade_rate,recovery_count,circuit_breaker_state
degrade.monitor.alert.enabled=true
degrade.monitor.alert.degrade.rate.threshold=0.1  # 10%降级率告警
degrade.monitor.alert.circuit.breaker.open.duration.seconds=300  # 5分钟打开告警

# 业务降级配置
business.degrade.enabled=true
business.degrade.feature.switch.enabled=true
business.degrade.feature.switch.config.file=/etc/mq/feature-switch.json
business.degrade.priority.adjust.enabled=true
business.degrade.priority.levels=high,medium,low

# 故障隔离配置
fault.isolation.enabled=true
fault.isolation.detection.enabled=true
fault.isolation.detection.interval.seconds=10
fault.isolation.isolation.enabled=true
fault.isolation.recovery.enabled=true
fault.isolation.recovery.strategy=automatic
